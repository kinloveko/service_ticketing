<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.com">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Fontawesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Boxicons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<!-- My CSS -->
	<link rel="stylesheet" href="css/style.css">
	<!-- SweetAlert -->
	<link rel="stylesheet" href="sweetalert2.min.css">
	<!-- My Bootstrap CSS -->
	<link
	  href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.2.0/mdb.min.css"
	  rel="stylesheet"
	/>
	
	<!-- My Bootstrap CSS -->
		<link rel="stylesheet" th:href="'https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css'">
<script th:src="'https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'"></script>
<script th:src="'https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js'"></script>
<script th:src="'https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js'"></script>
	
	<title>Dashboard</title>
</head>
<body>


	<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
		<img src="img/brandlogo.png" style="width:60px;height:60px">
			<span class="text" style="color:gray">ARK</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="#">
					<i class='bx bxs-dashboard' ></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li class="menu-item " data-table="pending" onclick="handleClick(this)">
				<a href="#">
					<i class='bx bxs-shopping-bag-alt' ></i>
					<span class="text">My Tickets</span>
				</a>
			</li>
			<li class="menu-item " data-table="ongoing" onclick="handleClick(this)">
				<a href="#">
					<i class='bx bxs-doughnut-chart' ></i>
					<span class="text">On-going Tickets</span>
				</a>
			</li>
			<li class="menu-item " data-table="completed" onclick="handleClick(this)">
				<a href="#">
					<i class='bx bxs-message-dots' ></i>
					<span class="text">Completed Tickets</span>
				</a>
			</li>
			<li>
				<a href="#">
					<i class='bx bxs-group' ></i>
					<span class="text">Team</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="#">
					<i class='bx bxs-cog' ></i>
					<span class="text">Settings</span>
				</a>
			</li>
			<li>
				<a href="/logout" class="logout">
					<i class='bx bxs-log-out-circle' ></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->



	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu' ></i>
			<a href="#" class="nav-link">Categories</a>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search' ></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell' ></i>
				<span class="num">8</span>
			</a>
			<a href="#" class="profile">
				<img src="img/people.png">
			</a>
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right' ></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul>
				</div>
				<a style="cursor:pointer;" data-toggle="modal" data-target="#createTicket" class="btn-download">
					<i class='bx bxs-cloud-download' ></i>
					<span class="text">Create Ticket</span>
				</a>
			</div>

		<ul class="box-info">
   <li class="menu-item active" data-table="pending" onclick="handleClick(this)">
        <i class='bx bxs-calendar-check' ></i>
        <span class="text">
            <h3 th:text="${pending_count}">0</h3>
            <p>Pending Tickets</p>
        </span>
    </li>
     <li class="menu-item " data-table="ongoing" onclick="handleClick(this)">
        <i class='bx bxs-group' ></i>
        <span class="text">
            <h3 th:text="${ongoing_count}">0</h3>
            <p>On-going Tickets</p>
        </span>
    </li>
   <li class="menu-item " data-table="completed" onclick="handleClick(this)">
        <i class='bx bxs-check-circle' ></i>
        <span class="text">
            <h3 th:text="${completed_count}">0</h3>
            <p>Completed Tickets</p>
        </span>
    </li>
</ul>


			
<!-- Pending Table -->
		<div class="table-data" id="pending-table">
    <div class="order">
        <div class="head">
            <h3>Pending tickets</h3>
            <i class='bx bx-search' ></i>
            <i class='bx bx-filter' ></i>
        </div>
       <table>
                        <thead>
                            <tr>
                                <th>Ticket #</th>
                                <th>User</th>
                                 <th>Title</th>
                                <th>Description</th>
                                <th>Date issue</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="b, i :${pending_tickets}">
                                 <td th:text="${b.ticket_id}"></td>    
                                          <td th:text="${b.user_name}"></td>
                                <td  th:text="${b.title}"></td>
                                  <td th:text="${b.description}"></td>
                                <td th:text="${b.created_on}"></td>
                                <td th:text="${b.status}">
                                <td th:text="${b.conforme_no}">
                                <span class="status completed"></span></td>
                                <td>
                           
 							 <button type="button" class="btn btn-success my-2 eBtn" th:href="@{/tickets/{ticketId}(ticketId=${b.ticket_id})}"  data-toggle="modal" data-target="#viewTicket"><i class="fa fa-edit" style="font-size:20px;"></i></button>
                                <button type="button" class="btn btn-danger my-2"><i class="fa fa-trash" style="font-size:20px;"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
    </div>
    </div>
    
    <!-- Ongoing Table -->
		<div class="table-data" id="ongoing-table" style="display:none">
    <div class="order">
        <div class="head">
            <h3>Ongoing tickets</h3>
            <i class='bx bx-search' ></i>
            <i class='bx bx-filter' ></i>
        </div>
       <table>
                        <thead>
                            <tr>
                                <th>Ticket #</th>
                                <th>User</th>
                                 <th>Title</th>
                                <th>Date issue</th>
                                <th>Status</th>
                                  <th>Conforme no.</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="b, i :${ongoing_tickets}">
                                 <td th:text="${b.ticket_id}"></td>    
                                          <td th:text="${b.user_name}"></td>
                                <td  th:text="${b.title}"></td>
                                <td style=" display: none;"  th:text="${b.description}"></td>
                                <td th:text="${b.created_on}"></td>
                                <td th:text="${b.status}">
                                <td th:text="${b.conforme_no}">
                                <span class="status completed"></span></td>
                                <td>
                              <button type="button" class="btn btn-primary my-2 ml-2 conforme_ongoing" th:href="@{/tickets/{ticketId}(ticketId=${b.ticket_id})}" data-toggle="modal" data-target="#conformeTicket">
							    <i data-toggle="tooltip" class="fa fa-eye" style="font-size:20px;"></i>
							</button>
 							  </td>
                            </tr>
                        </tbody>
                    </table>
    </div>
    </div>
  
    <!-- Completed Table -->
		<div class="table-data" id="completed-table" style="display:none">
    <div class="order">
        <div class="head">
            <h3>Completed tickets</h3>
            <i class='bx bx-search' ></i>
            <i class='bx bx-filter' ></i>
        </div>
       <table>
                        <thead>
                            <tr>
                                <th>Ticket #</th>
                                <th>User</th>
                                 <th>Title</th>
                                <th>Description</th>
                                <th>Date issue</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="b, i :${completed_tickets}">
                                 <td th:text="${b.ticket_id}"></td>    
                                          <td th:text="${b.user_name}"></td>
                                <td  th:text="${b.title}"></td>
                                  <td th:text="${b.description}"></td>
                                <td th:text="${b.created_on}"></td>
                                <td th:text="${b.status}">
                                <td th:text="${b.conforme_no}">
                                <span class="status completed"></span></td>
                                <td>
                              <button type="button" class="btn btn-primary my-2 ml-2 "  data-toggle="modal" data-target="#viewTicket">
							    <i data-toggle="tooltip" class="fa fa-eye" style="font-size:20px;"></i>
							</button>

 							 <button type="button" class="btn btn-success my-2 " data-toggle="modal" data-target="#editTicket"><i class="fa fa-edit" style="font-size:20px;"></i></button>
                                <button type="button" class="btn btn-danger my-2"><i class="fa fa-trash" style="font-size:20px;"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
    </div>
    </div>
  
    
		</main>
		<!-- MAIN -->
		<!-- Create Ticket Modal -->
		<form method="post" th:action="@{/tickets/post-ticket}">
		<div class="modal fade" id="createTicket" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="exampleModalLabel">Create Ticket</h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		      	<div class="form-group">
				   <input type="hidden" name="user_name" th:value="${session.user_name}">
				   <input type="hidden" name="user_id" th:value="${session.user_id}">
				</div>
				<div class="form-group">
				  <label for="title">Title:</label>
				  <input type="text" class="form-control" name="title">
				</div>
				<div class="form-group">
				  <label for="issue">Issue:</label>
				  <textarea class="form-control" rows="5" name="description"></textarea>
				  			
				</div>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		        <button type="submit" class="btn btn-primary" id="createTicket">Save ticket</button>
		      </div>
		    </div>
		  </div>
	  </div>
	  </form>
 	<!-- Create Ticket End Modal -->
	  <!-- View Ticket Modal -->
  <form method="post" th:action="@{/tickets/post-ticket}">
	
<div class="modal fade" id="viewTicket" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">View Ticket</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            
            <div class="modal-body">
    <div class="row">
        <div class="col-sm-6">
            <div class="form-group">
                <label for="id" class="col-form-label">Ticket No</label>
                <input type="text" class="form-control" id="id" name="ticket_id" readonly>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="form-group">
                <label for="date" class="col-form-label">Date Created</label>
                <input type="text" class="form-control" id="date" name="created_on" readonly>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label for="title" class="col-form-label">Title</label>
        <input type="text" class="form-control" id="title" name="title" readonly>
    </div>
    <div class="form-group">
        <label for="description" class="col-form-label">Description</label>
        <textarea class="form-control" id="description" name="description"></textarea>
    </div>
    <div class="form-group">
        <label for="name" class="col-form-label">Client Name</label>
        <input type="text" class="form-control" id="name" name="user_name" readonly>
    </div>
    <div class="form-group">
        <label for="status" class="col-form-label">Status</label>
        <input type="text" class="form-control" id="status" name="status" readonly>
    </div>
</div>
            <div class="modal-footer">
                     <button type="submit" class="btn btn-primary" >Update</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
            
        </div>
    </div>
</div>
</form>
	


 <!-- Conformed Slip Modal -->
		<form>
		<div class="modal fade" id="conformeTicket" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="text-align:center;" id="exampleModalLabel">On-going Ticket</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            
            <div class="modal-body">
    <div class="row">
        <div class="col-sm-6">
            <div class="form-group">
                <label for="id" class="col-form-label">Ticket No.</label>
                <input type="text" class="form-control" name="ticket_id" readonly>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="form-group">
                <label for="date" class="col-form-label">Conforme No.</label>
                <input type="text" class="form-control" name="created_on" readonly>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label for="title" class="col-form-label">Title</label>
        <input type="text" class="form-control" id="title" name="title" readonly>
    </div>
    <div class="form-group">
        <label for="description" class="col-form-label">Description</label>
        <textarea class="form-control" rows="5" name="description" readonly></textarea>
    </div>
     <div class="row">
        <div class="col-sm-6">
    <div class="form-group">
        <label for="name" class="col-form-label">Amount</label>
        <input type="text" class="form-control" name="user_name" readonly>
    </div>
    </div>
     <div class="col-sm-6">
    <div class="form-group">
        <label for="status" class="col-form-label">Progress</label>
        <input type="text" class="form-control" name="status" readonly>
    </div>
    </div>
    </div>
    <div class="mb-3">
	  	<label for="customFile" class="form-label">Proof of Payment</label>
	  	<input type="file" class="form-control" id="customFile" />
	</div>
	<div class="mb-3">
	  	<label for="customFile" class="form-label">Client's Signature</label>
	  	<input type="file" class="form-control" id="customFile" />
	</div>
	<div class="mb-1">
	<label style="font-weight: bold;" for="formFileSm" class="form-label">Sale's Team Signature</label>
	</div>
	<div class="mb-5">
	<img style="width:75px;height:75px;margin-left:30px;" src="img/sample_signature.png" class="rounded float-left">
	</div>
	</div>
            <div class="modal-footer">
                     <button type="submit" class="btn btn-primary" >Submit</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
            
        </div>
    </div>
		  </div>
		  </form>
		  <!-- Conforme Ticket End Modal -->	
	
	</section>
	<!-- CONTENT -->
	
	<script src="Javascript/dashboard.js"></script>
	<!-- SweetAlert JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	 <script th:if="${successMessage}">
        Swal.fire({
            title: 'Success',
            text: 'Ticket saved successfully!',
            icon: 'success',
            confirmButtonText: 'OK'
        });
    </script>

	
		<script type="text/javascript">
		
		function updateTicket() {
			  const form = document.querySelector('#updateTicketForm');
			  const formData = new FormData(form);

			  fetch(form.action, {
			    method: 'PUT',
			    body: formData
			  })
			  .then(response => {
			    if (response.ok) {
			      location.reload();
			    } else {
			      console.error('Failed to update ticket');
			    }
			  })
			  .catch(error => console.error(error));
			}
		
		
			
		$(document).ready(function() {
			$('.conforme_ongoing').on('click', function(event) {
				
				event.preventDefault();	
				
				var ticketId = $(this).closest('tr').find('td:eq(0)').text();
				var dateCreated = $(this).closest('tr').find('td:eq(4)').text();
				var title = $(this).closest('tr').find('td:eq(2)').text();
				var description = $(this).closest('tr').find('td:eq(3)').text();
				var userName = $(this).closest('tr').find('td:eq(1)').text();
				var status = $(this).closest('tr').find('td:eq(5)').text();
				var conforme_no = $(this).closest('tr').find('td:eq(6)').text();
				$('#id').val(ticketId);
				$('#date').val(dateCreated);
				$('#title').val(title);
				$('#description').val(description);
				$('#name').val(userName);
				$('#status').val(status);
				$('#conforme_no').val(conforme_no);
				$('#conformeTicket').modal();
				
				
			});
		});
	$(document).ready(function() {
		$('.eBtn').on('click', function(event) {
			
			event.preventDefault();	
			
			var ticketId = $(this).closest('tr').find('td:eq(0)').text();
			var dateCreated = $(this).closest('tr').find('td:eq(4)').text();
			var title = $(this).closest('tr').find('td:eq(2)').text();
			var description = $(this).closest('tr').find('td:eq(3)').text();
			var userName = $(this).closest('tr').find('td:eq(1)').text();
			var status = $(this).closest('tr').find('td:eq(5)').text();
			var conforme_no = $(this).closest('tr').find('td:eq(6)').text();
			$('#id').val(ticketId);
			$('#date').val(dateCreated);
			$('#title').val(title);
			$('#description').val(description);
			$('#name').val(userName);
			$('#status').val(status);
			$('#conforme_no').val(conforme_no);
			$('#viewTicket').modal();
			
			
		});
	});
</script>
<script>

function handleClick(menuItem) {
	  // Get selected menu item and corresponding table ID
	  var selectedTableId = $(menuItem).data('table');

	  // Remove active class from all menu items and add to selected item
	  $('.menu-item').removeClass('active');
	  $(menuItem).addClass('active');

	  // Hide all tables and show selected table
	  $('.table-data').hide();
	  $('#' + selectedTableId + '-table').show();
	}
</script>
	
</body>